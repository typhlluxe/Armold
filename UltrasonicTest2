import lejos.hardware.Sound;
import lejos.hardware.motor.Motor;
import lejos.hardware.port.SensorPort;
import lejos.hardware.sensor.EV3UltrasonicSensor;
import lejos.robotics.RangeFinderAdapter;
import lejos.robotics.chassis.Chassis;
import lejos.robotics.chassis.Wheel;
import lejos.robotics.chassis.WheeledChassis;
import lejos.robotics.navigation.MovePilot;
import lejos.utility.Timer;
import lejos.utility.TimerListener;

public class UltrasonicTest 
{
	
	private static boolean noObstacle = true;
	
	public static void setUp()
	{
		Wheel wheels = new Wheel;
		WheeledChassis chasis = new WheeledChassis(null, 0);
		MovePilot pilot = new MovePilot(chasis);  // parameters in inches
		EV3UltrasonicSensor    ultra = new EV3UltrasonicSensor(SensorPort.S1);
		
		init();
	}
	
	private static void init() 
	{
		Sound.beepSequenceUp();  // make sound when ready.
		final RangeFinderAdapter sonar = new RangeFinderAdapter(ultra); 
		pilot.setRotateSpeed(10); // cm per second
		
		Timer timer = new Timer(200,new TimerListener() 
		{
			
			@Override
			public void timedOut() 
			{
				sensorCheck(sonar);
			}
		});
		
		timer.start();
		move(pilot);
	}
		
	private static void sensorCheck(RangeFinderAdapter sonar) {
		if (sonar.getRange() < 0.25f) {
			//obstacleAhead();
			Sound.beep();
			noObstacle = false;
		} else {
			noObstacle = true;
		}
	}
	
	private static void move(MovePilot pilot) {
		int n = 1;
		do {
		while (noObstacle) {
			pilot.travel(4);
		}
		recover(pilot);
		n++;
		} while(n < 2);
	}
	
	private static void recover(MovePilot pilot) 
	{
		pilot.travel(-20);
		pilot.rotateLeft();
	}
	
	public static void main(String[] args) 
	{	
		setUp();
	}

}
